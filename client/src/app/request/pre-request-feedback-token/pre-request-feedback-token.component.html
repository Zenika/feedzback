<app-message type="light" icon="lightbulb" i18n="@@Component.PreRequestFeedbackToken.Info">
  Générez un lien à partager avec vos collègues. Ainsi vous n'ayez pas besoin de connaître leurs adresses emails à
  l'avance.
</app-message>

<form [formGroup]="form" (ngSubmit)="onSubmit()">
  <mat-form-field appearance="outline" class="gbl-form-field">
    <mat-label i18n="@@Feedback.Message">Message</mat-label>

    <textarea
      #message
      [formControl]="form.controls.message"
      [maxlength]="messageMaxLength"
      matInput
      rows="4"
    ></textarea>

    <mat-hint align="start">
      <button type="button" [matMenuTriggerFor]="useTemplate" class="gbl-button-less gbl-link gbl-link--no-underline">
        <mat-icon class="me-1 align-text-bottom" style="font-size: 1.125rem">edit_note</mat-icon>
        <ng-container i18n="@@Component.RequestFeedback.UseTemplate">S'inspirer d'un modèle</ng-container>
      </button>

      <mat-menu #useTemplate="matMenu" xPosition="before" yPosition="above" class="gbl-overlay-menu">
        <button
          mat-menu-item
          class="italic opacity-50"
          i18n="@@Component.RequestFeedback.NoTemplate"
          (click)="applyTemplate('')"
        >
          Aucun modèle
        </button>
        @for (tmpl of requestTemplates; track tmpl; let index = $index) {
          <button mat-menu-item (click)="applyTemplate(tmpl.content)">{{ tmpl.title }}</button>
        }
      </mat-menu>
    </mat-hint>

    <mat-hint align="end">{{ message.value.length }} / {{ messageMaxLength }}</mat-hint>
  </mat-form-field>

  <div class="gbl-form-field">
    <mat-slide-toggle [formControl]="form.controls.shared">
      <ng-container i18n="@@Component.RequestFeedback.Share">Partager le feedZback avec votre manager</ng-container>
      <button
        type="button"
        class="gbl-button-less gbl-link ms-1 align-middle"
        appDialogTooltip
        ariaLabelFromDialogTitle
        dialogTitle="Pourquoi le partage du feedZback est recommandé ?"
        dialogContent="En partageant le feedZback avec votre manager, vous pourrez échanger ensemble et ainsi bénéficier au mieux de son contenu. Notez que le message de la demande fait partie du feedZback et sera donc visible par votre manager."
        dialogWidth="600px"
        i18n-dialogTitle="@@Component.RequestFeedback.ShareFeedbackMessageTitle"
        i18n-dialogContent="@@Component.RequestFeedback.ShareFeedbackMessageContent"
      >
        <mat-icon>help</mat-icon>
      </button>
    </mat-slide-toggle>
  </div>

  <div class="gbl-form-submit">
    <button [disabled]="form.invalid || form.disabled" mat-flat-button>
      <mat-icon>add_link</mat-icon>
      <ng-container i18n="@@Action.Generate">Générer</ng-container>
    </button>

    <div class="gbl-form-submit__info">
      <mat-icon>info</mat-icon>
      <ng-container i18n="@@Message.FieldsRequired">Les champs marqués d'une * sont obligatoires</ng-container>
    </div>
  </div>
</form>
