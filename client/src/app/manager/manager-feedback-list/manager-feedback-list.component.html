<mat-form-field appearance="fill" class="app-manager-feedback-list__filter">
  <input
    #input
    matInput
    placeholder="Rechercher par email"
    i18n-placeholder="@@Common.SearchByEmail"
    [value]="filter"
    (keyup)="onFilter(input.value)"
  />
  @if (filter) {
    <mat-icon mat-icon-button color="warn" matIconSuffix role="button" (click)="onFilter('')">close</mat-icon>
  }
  <mat-icon matIconSuffix>search</mat-icon>
</mat-form-field>

<table mat-table [dataSource]="dataSource" multiTemplateDataRows matSort>
  <ng-container matColumnDef="email">
    <th mat-header-cell *matHeaderCellDef mat-sort-header i18n="@@ManagerFeedbackList.GivenBy">Donné par</th>
    <td mat-cell *matCellDef="let element">{{ f(element).giverEmail }}</td>
  </ng-container>

  <ng-container matColumnDef="date">
    <th mat-header-cell *matHeaderCellDef mat-sort-header i18n="@@ManagerFeedbackList.Date">Date</th>
    <td mat-cell *matCellDef="let element">{{ f(element).updatedAt | date: 'shortDate' }}</td>
  </ng-container>

  <ng-container matColumnDef="expand">
    <th mat-header-cell *matHeaderCellDef></th>
    <td mat-cell *matCellDef="let element" class="app-manager-feedback-list__expand">
      <button mat-icon-button color="primary">
        @if (expandedFeedback === element) {
          <mat-icon>keyboard_arrow_up</mat-icon>
        } @else {
          <mat-icon>keyboard_arrow_down</mat-icon>
        }
      </button>
    </td>
  </ng-container>

  <ng-container matColumnDef="expandedDetail">
    <td mat-cell *matCellDef="let element" [attr.colspan]="columns.length">
      <div [@detailExpand]="element === expandedFeedback ? 'expanded' : 'collapsed'">
        <app-feedback-body [feedback]="f(element)" class="app-manager-feedback-list__item" />
      </div>
    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="columns"></tr>
  <tr
    mat-row
    *matRowDef="let element; columns: columns"
    class="app-manager-feedback-list__row"
    [class.app-manager-feedback-list__row--expanded]="expandedFeedback === element"
    (click)="expandedFeedback = expandedFeedback === element ? null : element"
  ></tr>

  <tr
    mat-row
    *matRowDef="let element; columns: ['expandedDetail']"
    class="app-manager-feedback-list__row-detail"
    [class.app-manager-feedback-list__row-detail--collapsed]="expandedFeedback !== element"
  ></tr>

  <tr class="mat-row" *matNoDataRow>
    @if (filter) {
      <td class="mat-cell p-6 text-center italic text-gray-400" [attr.colspan]="columns.length">
        <ng-container i18n="@@Common.NoResultFor">Aucun résultat pour</ng-container> "{{ filter }}"
      </td>
    }
  </tr>
</table>

<mat-paginator [style.display]="hasPaginator ? undefined : 'none'" [pageSizeOptions]="pageSizeOptions"></mat-paginator>
