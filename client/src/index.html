<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>FeedZback</title>
    <base href="/" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/svg+xml" href="favicon.svg" />

    <script>
      const pathnameStartsWith = (prefix) => window.location.pathname.startsWith(prefix);

      const getLanguageFromBrowser = () => {
        const supportedLanguages = ['fr', 'en'];
        const defaultLanguage = supportedLanguages[0];
        const userLanguage = window.navigator.languages.find((language) => supportedLanguages.includes(language));
        return userLanguage ?? defaultLanguage;
      };
      const languageFromBrowser = getLanguageFromBrowser();

      const hasLanguageFromCookie = document.cookie.includes('firebase-language-override');
      const isLanguageFromCookie = (language) => document.cookie.includes(`firebase-language-override=${language}`);

      const isLanguage = (language) =>
        hasLanguageFromCookie ? isLanguageFromCookie(language) : languageFromBrowser === language;

      const setCookie = (language, country) => {
        document.cookie = `firebase-language-override=${language}; path=/`;
        document.cookie = `firebase-country-override=${country}; path=/`;
      };

      if (pathnameStartsWith('/fr') && isLanguage('en')) {
        setCookie('fr', 'FR');
        console.log('Overwrite cookie to fr-FR');
        window.location.reload();
      } else if (pathnameStartsWith('/en') && isLanguage('fr')) {
        setCookie('en', 'US');
        console.log('Overwrite cookie to en-US');
        window.location.reload();
      }
    </script>
  </head>
  <body class="mat-typography">
    <app-root></app-root>
  </body>
</html>
